!function(e,t){"function"==typeof define&&define.amd?define("ev-emitter/ev-emitter",t):"object"==typeof module&&module.exports?module.exports=t():e.EvEmitter=t()}("undefined"!=typeof window?window:this,function(){function e(){}var t=e.prototype;return t.on=function(e,t){var o;if(e&&t)return-1==(o=(o=this._events=this._events||{})[e]=o[e]||[]).indexOf(t)&&o.push(t),this},t.once=function(e,t){var o;if(e&&t)return this.on(e,t),((o=this._onceEvents=this._onceEvents||{})[e]=o[e]||{})[t]=!0,this},t.off=function(e,t){e=this._events&&this._events[e];if(e&&e.length)return-1!=(t=e.indexOf(t))&&e.splice(t,1),this},t.emitEvent=function(e,t){var o=this._events&&this._events[e];if(o&&o.length){o=o.slice(0),t=t||[];for(var i=this._onceEvents&&this._onceEvents[e],n=0;n<o.length;n++){var s=o[n];i&&i[s]&&(this.off(e,s),delete i[s]),s.apply(this,t)}return this}},t.allOff=function(){delete this._events,delete this._onceEvents},e}),function(t,o){"use strict";"function"==typeof define&&define.amd?define(["ev-emitter/ev-emitter"],function(e){return o(t,e)}):"object"==typeof module&&module.exports?module.exports=o(t,require("ev-emitter")):t.imagesLoaded=o(t,t.EvEmitter)}("undefined"!=typeof window?window:this,function(t,e){function s(e,t){for(var o in t)e[o]=t[o];return e}function r(e,t,o){var i,n;return this instanceof r?(i="string"==typeof(i=e)?document.querySelectorAll(e):i)?(this.elements=(n=i,Array.isArray(n)?n:"object"==typeof n&&"number"==typeof n.length?c.call(n):[n]),this.options=s({},this.options),"function"==typeof t?o=t:s(this.options,t),o&&this.on("always",o),this.getImages(),d&&(this.jqDeferred=new d.Deferred),void setTimeout(this.check.bind(this))):void a.error("Bad element for imagesLoaded "+(i||e)):new r(e,t,o)}function o(e){this.img=e}function i(e,t){this.url=e,this.element=t,this.img=new Image}var d=t.jQuery,a=t.console,c=Array.prototype.slice,l=((r.prototype=Object.create(e.prototype)).options={},r.prototype.getImages=function(){this.images=[],this.elements.forEach(this.addElementImages,this)},r.prototype.addElementImages=function(e){"IMG"==e.nodeName&&this.addImage(e),!0===this.options.background&&this.addElementBackgroundImages(e);var t=e.nodeType;if(t&&l[t]){for(var o=e.querySelectorAll("img"),i=0;i<o.length;i++){var n=o[i];this.addImage(n)}if("string"==typeof this.options.background)for(var s=e.querySelectorAll(this.options.background),i=0;i<s.length;i++){var r=s[i];this.addElementBackgroundImages(r)}}},{1:!0,9:!0,11:!0});return r.prototype.addElementBackgroundImages=function(e){var t=getComputedStyle(e);if(t)for(var o=/url\((['"])?(.*?)\1\)/gi,i=o.exec(t.backgroundImage);null!==i;){var n=i&&i[2];n&&this.addBackground(n,e),i=o.exec(t.backgroundImage)}},r.prototype.addImage=function(e){e=new o(e);this.images.push(e)},r.prototype.addBackground=function(e,t){e=new i(e,t);this.images.push(e)},r.prototype.check=function(){function t(e,t,o){setTimeout(function(){i.progress(e,t,o)})}var i=this;return this.progressedCount=0,this.hasAnyBroken=!1,this.images.length?void this.images.forEach(function(e){e.once("progress",t),e.check()}):void this.complete()},r.prototype.progress=function(e,t,o){this.progressedCount++,this.hasAnyBroken=this.hasAnyBroken||!e.isLoaded,this.emitEvent("progress",[this,e,t]),this.jqDeferred&&this.jqDeferred.notify&&this.jqDeferred.notify(this,e),this.progressedCount==this.images.length&&this.complete(),this.options.debug&&a&&a.log("progress: "+o,e,t)},r.prototype.complete=function(){var e=this.hasAnyBroken?"fail":"done";this.isComplete=!0,this.emitEvent(e,[this]),this.emitEvent("always",[this]),this.jqDeferred&&(e=this.hasAnyBroken?"reject":"resolve",this.jqDeferred[e](this))},(o.prototype=Object.create(e.prototype)).check=function(){return this.getIsImageComplete()?void this.confirm(0!==this.img.naturalWidth,"naturalWidth"):(this.proxyImage=new Image,this.proxyImage.addEventListener("load",this),this.proxyImage.addEventListener("error",this),this.img.addEventListener("load",this),this.img.addEventListener("error",this),void(this.proxyImage.src=this.img.src))},o.prototype.getIsImageComplete=function(){return this.img.complete&&this.img.naturalWidth},o.prototype.confirm=function(e,t){this.isLoaded=e,this.emitEvent("progress",[this,this.img,t])},o.prototype.handleEvent=function(e){var t="on"+e.type;this[t]&&this[t](e)},o.prototype.onload=function(){this.confirm(!0,"onload"),this.unbindEvents()},o.prototype.onerror=function(){this.confirm(!1,"onerror"),this.unbindEvents()},o.prototype.unbindEvents=function(){this.proxyImage.removeEventListener("load",this),this.proxyImage.removeEventListener("error",this),this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},(i.prototype=Object.create(o.prototype)).check=function(){this.img.addEventListener("load",this),this.img.addEventListener("error",this),this.img.src=this.url,this.getIsImageComplete()&&(this.confirm(0!==this.img.naturalWidth,"naturalWidth"),this.unbindEvents())},i.prototype.unbindEvents=function(){this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},i.prototype.confirm=function(e,t){this.isLoaded=e,this.emitEvent("progress",[this,this.element,t])},(r.makeJQueryPlugin=function(e){(e=e||t.jQuery)&&((d=e).fn.imagesLoaded=function(e,t){return new r(this,e,t).jqDeferred.promise(d(this))})})(),r}),function(s){"use strict";s.fn.fitVids=function(e){var t,o,n={customSelector:null,ignore:null};return document.getElementById("fit-vids-style")||(t=document.head||document.getElementsByTagName("head")[0],(o=document.createElement("div")).innerHTML='<p>x</p><style id="fit-vids-style">.fluid-width-video-container{flex-grow: 1;width:100%;}.fluid-width-video-wrapper{width:100%;position:relative;padding:0;}.fluid-width-video-wrapper iframe,.fluid-width-video-wrapper object,.fluid-width-video-wrapper embed {position:absolute;top:0;left:0;width:100%;height:100%;}</style>',t.appendChild(o.childNodes[1])),e&&s.extend(n,e),this.each(function(){var e=['iframe[src*="player.vimeo.com"]','iframe[src*="youtube.com"]','iframe[src*="youtube-nocookie.com"]','iframe[src*="kickstarter.com"][src*="video.html"]',"object","embed"],i=(n.customSelector&&e.push(n.customSelector),".fitvidsignore"),e=(n.ignore&&(i=i+", "+n.ignore),s(this).find(e.join(",")));(e=(e=e.not("object object")).not(i)).each(function(){var e,t,o=s(this);0<o.parents(i).length||"embed"===this.tagName.toLowerCase()&&o.parent("object").length||o.parent(".fluid-width-video-wrapper").length||(o.css("height")||o.css("width")||!isNaN(o.attr("height"))&&!isNaN(o.attr("width"))||(o.attr("height",9),o.attr("width",16)),e=("object"===this.tagName.toLowerCase()||o.attr("height")&&!isNaN(parseInt(o.attr("height"),10))?parseInt(o.attr("height"),10):o.height())/(isNaN(parseInt(o.attr("width"),10))?o.width():parseInt(o.attr("width"),10)),o.attr("name")||(t="fitvid"+s.fn.fitVids._count,o.attr("name",t),s.fn.fitVids._count++),o.wrap('<div class="fluid-width-video-container"><div class="fluid-width-video-wrapper"></div></div>').parent(".fluid-width-video-wrapper").css("padding-top",100*e+"%"),o.removeAttr("height").removeAttr("width"))})})},s.fn.fitVids._count=0}(window.jQuery||window.Zepto),function(){const i=window.matchMedia("(max-width: 991px)"),n=document.querySelector(".gh-head-menu"),s=n.querySelector(".nav");if(s){var e=document.querySelector(".gh-head-logo");const t=s.innerHTML,o=(i.matches&&s.querySelectorAll("li").forEach(function(e,t){e.style.transitionDelay=.03*(t+1)+"s"}),function(){if(!i.matches){for(var e=[];s.offsetWidth+64>n.offsetWidth;){if(!s.lastElementChild)return;e.unshift(s.lastElementChild),s.lastElementChild.remove()}if(e.length){const t=document.createElement("button"),o=(t.setAttribute("class","nav-more-toggle"),t.setAttribute("aria-label","More"),t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" fill="currentColor"><path d="M21.333 16c0-1.473 1.194-2.667 2.667-2.667v0c1.473 0 2.667 1.194 2.667 2.667v0c0 1.473-1.194 2.667-2.667 2.667v0c-1.473 0-2.667-1.194-2.667-2.667v0zM13.333 16c0-1.473 1.194-2.667 2.667-2.667v0c1.473 0 2.667 1.194 2.667 2.667v0c0 1.473-1.194 2.667-2.667 2.667v0c-1.473 0-2.667-1.194-2.667-2.667v0zM5.333 16c0-1.473 1.194-2.667 2.667-2.667v0c1.473 0 2.667 1.194 2.667 2.667v0c0 1.473-1.194 2.667-2.667 2.667v0c-1.473 0-2.667-1.194-2.667-2.667v0z"></path></svg>',document.createElement("div"));o.setAttribute("class","gh-dropdown"),10<=e.length?(document.body.classList.add("is-dropdown-mega"),o.style.gridTemplateRows="repeat("+Math.ceil(e.length/2)+", 1fr)"):document.body.classList.remove("is-dropdown-mega"),e.forEach(function(e){o.appendChild(e)}),t.appendChild(o),s.appendChild(t),document.body.classList.add("is-dropdown-loaded"),t.addEventListener("click",function(){document.body.classList.toggle("is-dropdown-open")}),window.addEventListener("click",function(e){!t.contains(e.target)&&document.body.classList.contains("is-dropdown-open")&&document.body.classList.remove("is-dropdown-open")})}else document.body.classList.add("is-dropdown-loaded")}});imagesLoaded(e,function(){o()}),window.addEventListener("resize",function(){setTimeout(function(){s.innerHTML=t,o()},1)})}}();import{plansModal}from"./settings";import{closeModal}from"./modals-controller";import{subscribeUser}from"./subscribe";$(document).ready(function(){let o="",t;window.addEventListener("unlockProtocol.closeModal",function(e){closeModal(plansModal)}),window.addEventListener("unlockProtocol.metadata",function(e){console.log("TX-META",e.detail[0].userAddress),t=e.detail[0].userAddress,o=e.detail[0].metadata.protected.email}),window.addEventListener("unlockProtocol.transactionSent",function(e){var t=e.detail.hash,e=e.detail.lock;subscribeUser(t,o,e)})});import"../css/modals.scss";import subscribe from"./subscribe";const chooseMonthlyBtn=document.getElementById("subscribe-monthly"),chooseYearlyBtn=document.getElementById("subscribe-yearly"),tierId=document.getElementById("tier-heading").dataset.tier;function handleClick(e=!1){console.log(`chose${e?"Yearly":"Monthly"}...`),(e?chooseYearlyBtn:chooseMonthlyBtn).classList.add("is-loading"),subscribe(tierId,e)}chooseMonthlyBtn.addEventListener("click",()=>handleClick()),chooseYearlyBtn.addEventListener("click",()=>handleClick(!0)),function(t,o){var i,n,s,r,d,a,c,l=o.querySelector("link[rel=next]");function h(){var e;404===this.status?(t.removeEventListener("scroll",m),t.removeEventListener("resize",p)):(this.response.querySelectorAll("article.post-card").forEach(function(e){i.appendChild(o.importNode(e,!0))}),(e=this.response.querySelector("link[rel=next]"))?l.href=e.href:(t.removeEventListener("scroll",m),t.removeEventListener("resize",p)),c=o.documentElement.scrollHeight,r=s=!1)}function e(){var e;r||(d+a<=c-n?s=!1:(r=!0,(e=new t.XMLHttpRequest).responseType="document",e.addEventListener("load",h),e.open("GET",l.href),e.send(null)))}function u(){s||t.requestAnimationFrame(e),s=!0}function m(){d=t.scrollY,u()}function p(){a=t.innerHeight,c=o.documentElement.scrollHeight,u()}l&&(i=o.querySelector(".post-feed"))&&(r=s=!(n=300),d=t.scrollY,a=t.innerHeight,c=o.documentElement.scrollHeight,t.addEventListener("scroll",m,{passive:!0}),t.addEventListener("resize",p),u())}(window,document);import{subscribeBtn}from"./settings";function closeModal(e){subscribeBtn.forEach(e=>{e.classList.remove("is-loading")}),e.classList.remove("is-active")}function openModal(e){e.classList.add("is-active")}document.addEventListener("DOMContentLoaded",()=>{var e,o;e=".plans-modal-trigger",o="gh-unlock_plans-modal",(document.querySelectorAll(e)||[]).forEach(e=>{const t=document.getElementById(o);e.addEventListener("click",e=>{e.preventDefault(),openModal(t)})}),document.querySelectorAll(".plans-modal-background, .plans-modal-close").forEach(e=>{const t=e.closest(".gh-unlock_plans-modal");e.addEventListener("click",()=>{closeModal(t)})}),document.querySelectorAll(".tx-modal-background, .tx-modal-close").forEach(e=>{const t=e.closest(".gh-unlock_tx-modal");e.addEventListener("click",()=>{var e;e=t,closeModal(e),location.reload()})}),document.addEventListener("keydown",e=>{27===(e||window.event).keyCode&&(document.querySelectorAll(".modal")||[]).forEach(e=>{closeModal(e)})})});const provider=window.ethereum;let locks={"0x5e4fadf7bd22d0b0f1ad32dbb646a96852810dac":{network:80001,name:"Back Benchers",emailRequired:!0}},networkConfigs={1:{provider:provider},5:{provider:provider},80001:{provider:provider}};module.exports={provider:provider,networkConfigs:networkConfigs,locks:locks};const subscribeBtn=document.querySelectorAll(".subscribe-btn"),plansModal=document.getElementById("gh-unlock_plans-modal"),unlockGhostApiBaseUrl="http://localhost:3000";module.exports={subscribeBtn:subscribeBtn,unlockGhostApiBaseUrl:unlockGhostApiBaseUrl,plansModal:plansModal};import{Paywall}from"@unlock-protocol/paywall";import{provider}from"./paywall-config";import{subscribeBtn,unlockGhostApiBaseUrl}from"./settings";function subscriptionSuccess(){$("#gh-unlock_success-modal").addClass("is-active")}function subscriptionError(e,t){var o=$("#gh-unlock_error-modal"),i=$("#error-msg"),t=t?t.message.toUpperCase()+": contact support":"";$("#error-txhash-section").toggleClass("is-hidden",!e),$("#error-txhash").text(e),i.text(t),o.addClass("is-active")}async function subscribeUser(e,t,o){try{var i=await fetch(unlockGhostApiBaseUrl+"/api/subscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({hash:e,email:t,lockAddress:o})});201!==i.status?subscriptionError(e,await i.json()):subscriptionSuccess()}catch(e){console.log("ERR_SUBSCRIBING_USER",e)}}async function subscribe(e,t=!1){try{var{name:o,monthlyLockAddress:i,yearlyLockAddress:n,network:s}=await(await fetch(unlockGhostApiBaseUrl+"/api/tier/get?tierId="+e)).json(),r={network:s,pessimistic:!0,locks:{[t?n:i]:{network:s,name:o,emailRequired:!0}},referrer:"0xCA7632327567796e51920F6b16373e92c7823854",persistentCheckout:!1},d={[s]:{provider:provider}},a=await new Paywall(r,d,provider).loadCheckoutModal();console.log("response@checkout::",a)}catch(e){console.log("SUBSCRIBE_ERR::",e.message),subscriptionError("",e)}finally{subscribeBtn.classList.remove("is-loading")}}export default subscribe;export{closeModal,subscribeUser,subscribe};
//# sourceMappingURL=casper.js.map